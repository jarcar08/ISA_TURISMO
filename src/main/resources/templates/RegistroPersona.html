<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Registro de Persona</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>

	<div class="container mt-5">
		<h2 class="mb-4">Registro de Persona</h2>

		<form id="registroPersonaForm" th:action="@{/persona/guardar}"
			method="post">
			<input type="hidden" name="perId" id="perId" value="">

			<div class="row">
				<div class="col-md-6 mb-3">
					<label for="perDni" class="form-label">DNI <span
						class="text-danger">*</span></label> <input type="text"
						class="form-control" id="perDni" name="perDni" required
						maxlength="8">
				</div>

				<div class="col-md-6 mb-3">
					<label for="perApellidoPaterno" class="form-label">Apellido
						Paterno <span class="text-danger">*</span>
					</label> <input type="text" class="form-control" id="perApellidoPaterno"
						name="perApellidoPaterno" required>
				</div>

				<div class="col-md-6 mb-3">
					<label for="perApellidoMaterno" class="form-label">Apellido
						Materno <span class="text-danger">*</span>
					</label> <input type="text" class="form-control" id="perApellidoMaterno"
						name="perApellidoMaterno" required>
				</div>

				<div class="col-md-6 mb-3">
					<label for="perNombres" class="form-label">Nombres <span
						class="text-danger">*</span></label> <input type="text"
						class="form-control" id="perNombres" name="perNombres" required>
				</div>

				<div class="col-md-6 mb-3">
					<label for="perCorreo" class="form-label">Correo
						electrónico <span class="text-danger">*</span>
					</label> <input type="email" class="form-control" id="perCorreo"
						name="perCorreo" required>
				</div>

				<div class="col-md-6 mb-3">
					<label for="tipopasajero" class="form-label">Tipo de
						Pasajero <span class="text-danger">*</span>
					</label> <select class="form-select" id="tipopasajero" name="tipopasajero"
						required>
						<option value="">-- Selecciona un Tipo --</option>
						<option th:each="tp : ${listaPasajero}" th:value="${tp.tpId}"
							th:text="${tp.tpNombre}"></option>
					</select>
				</div>
			</div>

			<button type="submit" class="btn btn-primary">Registrar
				Persona</button>
		</form>
	</div>

	<script>
    document.getElementById("registroPersonaForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const form = event.target;
        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            if (data === "ok") {
                alert("✅ Persona registrada correctamente.");
                // Redirigir a formulario de usuario usando el perId (puedes adaptarlo según tu flujo)
                const correo = document.getElementById("perCorreo").value;
                window.location.href = `/usuario/registro?personaId=${formData.get('perId')}`;
            } else {
                alert("❌ " + data.replace("error:", "").trim());
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("❌ Ocurrió un error al registrar persona.");
        });
    });
</script>

</body>
</html>
